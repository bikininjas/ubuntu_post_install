---
- name: Ubuntu VPS Post-Install
  hosts: vps
  become: true
  vars:
    ssh_port: 2244 # DÃ©finissez votre nouveau port SSH ici

  pre_tasks:
    - name: Update all apt packages before running roles
      ansible.builtin.apt:
        update_cache: true
        upgrade: dist
        autoremove: true
      tags:
        - always

  roles:
    - role: common
      tags: ["common"]
    - role: security
      tags: ["security"]
    - role: web_management
      tags: ["web_management"]
    - role: monitoring
      tags: ["monitoring"]
    - role: dev_tools
      tags: ["dev_tools"]

  tasks:
    - name: Post-setup checks (firewall and open ports)
      ansible.builtin.import_tasks: roles/common/tasks/verify.yml
